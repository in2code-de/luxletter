define(["jquery", "TYPO3/CMS/Backend/Notification"], function (e, notification) {
    "use strict";

    function t(e, notification) {
        var t = this, r = !1, n = !1;
        this.initialize = function () {
            i(), l(), u(), o(), c(), s(), d()
        };
        var l = function () {
            for (var e = document.querySelectorAll(".wizardform > fieldset"), t = document.querySelectorAll("[data-wizardform-gotostep]"), r = document.querySelectorAll(".wizard > a"), n = 1; n < e.length; n++) y(e[n]);
            for (var l = 0; l < t.length; l++) t[l].addEventListener("click", function (t) {
                t.preventDefault();
                var n = this.getAttribute("data-wizardform-gotostep");
                a(r, "current"), r[n - 1].classList.add("current");
                for (var l = 0; l < e.length; l++) y(e[l]);
                w(e[n - 1])
            })
        }, a = function (e, t) {
            for (var r = 0; r < e.length; r++) e[r].classList.remove(t)
        }, i = function () {
            null !== document.querySelector(".t3js-datetimepicker") && require(["TYPO3/CMS/Backend/DateTimePicker"], function (e) {
                e.initialize()
            })
        }, u = function () {
            var e = document.querySelector('[data-luxletter-wizardpreviewevent="users"]');
            null !== e && e.addEventListener("change", function () {
                v(TYPO3.settings.ajaxUrls["/luxletter/wizardUserPreview"], {usergroup: this.value}, "addWizardUserPreviewCallback")
            })
        }, o = function () {
            var e = document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]');
            null !== e && e.addEventListener("blur", function () {
                var e = document.querySelector('[data-luxletter-wizardpreview="newsletter"]');
                if (null !== e) {
                    e.innerHTML = "";
                    var t = document.createElement("iframe");
                    t.setAttribute("src", "//" + window.location.host + "/?type=1560777975&tx_luxletter_fe[origin]=" + encodeURIComponent(this.value)), t.setAttribute("class", "luxletter-iframepreview"), e.appendChild(t), r = !0, f()
                }
            })
        }, c = function () {
            var e = document.querySelector('[data-luxletter-testmail="submit"]');
            null !== e && e.addEventListener("click", function (e) {
                e.preventDefault();
                var t = document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]').value,
                    r = document.querySelector('[data-luxletter-testmail="email"]').value,
                    n = document.querySelector('[data-luxletter-testmail="subject"]').value;
                t && r && n && v(TYPO3.settings.ajaxUrls["/luxletter/testMail"], {
                    origin: t,
                    email: r,
                    subject: n
                }, "testMailListenerCallback")
            })
        }, s = function () {
            for (var e = document.querySelectorAll("[data-luxletter-linkmockaction]"), t = 0; t < e.length; t++) e[t].addEventListener("click", function () {
                var e = this.getAttribute("data-luxletter-linkmockaction");
                document.querySelector('[data-luxletter-linkmock-link="' + e + '"]').click()
            })
        }, d = function () {
            for (var e = document.querySelectorAll("[data-luxletter-action-ajax]"), t = 0; t < e.length; t++) e[t].addEventListener("click", function (e) {
                e.preventDefault();
                var t = this.getAttribute("data-luxletter-action-ajax");
                v(TYPO3.settings.ajaxUrls["/luxletter/receiverdetail"], {user: t}, "userDetailListenerCallback")
            })
        };
        this.addWizardUserPreviewCallback = function (e) {
            var t = document.querySelector('[data-luxletter-wizardpreview="users"]');
            null !== t && (t.innerHTML = e.html, n = !0, f())
        }, this.testMailListenerCallback = function (e) {
            var headerElement = document.querySelector('[data-luxletter-testmail="testmail-header"]');
            var messageElement = document.querySelector('[data-luxletter-testmail="testmail-message"]');
            if (headerElement !== null && messageElement !== null) {
                notification.success(
                    headerElement.getAttribute("data-luxletter-testmail-title"),
                    messageElement.getAttribute("data-luxletter-testmail-message")
                );
            }
        }, this.userDetailListenerCallback = function (e) {
            var t = document.getElementById("luxletter-newsletter-receiver-container");
            null !== t && (t.innerHTML = e.html)
        };
        var v = function (e, r, n) {
            if (void 0 !== e && "" !== e) {
                var l = new XMLHttpRequest;
                l.onreadystatechange = function () {
                    4 === this.readyState && 200 === this.status && null !== n && t[n](JSON.parse(this.responseText))
                }, l.open("POST", x(e, r), !0), l.send()
            } else console.log("No ajax URI given!")
        }, f = function () {
            if (m()) for (var e = document.querySelectorAll('[data-luxletter-wizardstatus="ready"]'), t = 0; t < e.length; t++) w(e[t])
        }, m = function () {
            return r && n
        }, x = function (e, t) {
            for (var r in t) t.hasOwnProperty(r) && (e += e.indexOf("?") !== -1 ? "&" : "?", e += r + "=" + encodeURIComponent(t[r]));
            return e
        }, y = function (e) {
            e.style.display = "none"
        }, w = function (e) {
            e.style.display = "block"
        }
    }

    e(document).ready(function () {
        var r = new t(e, notification);
        r.initialize()
    })
});
