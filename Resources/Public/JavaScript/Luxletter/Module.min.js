define(["jquery"],function(e){"use strict";function t(e){var n=this,i=!1,r=!1,t=(this.initialize=function(){t(),l(),c(),s(),d(),v(),f()},function(){for(var r=document.querySelectorAll(".wizardform > fieldset"),e=document.querySelectorAll("[data-wizardform-gotostep]"),l=document.querySelectorAll(".wizard > a"),t=1;t<r.length;t++)p(r[t]);for(var n=0;n<e.length;n++)e[n].addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("data-wizardform-gotostep");a(l,"current"),l[e-1].classList.add("current");for(var t=0;t<r.length;t++)p(r[t]);h(r[e-1]),w()})}),a=function(e,t){for(var r=0;r<e.length;r++)e[r].classList.remove(t)},l=function(){u();var e=document.querySelector('select[data-luxletter-wizardpreviewevent="users"]');null!==e&&e.addEventListener("change",function(e){u()})},u=function(){var e=[],t=(void 0!==window.luxLetterReceiverChoice&&(e=window.luxLetterReceiverChoice.getValue(!0)),document.querySelectorAll('input[data-luxletter-wizardpreviewevent="users"][type="hidden"]'));if(0<t.length)for(var r=0;r<t.length;r++)e.push(t[r].getAttribute("value"));m(TYPO3.settings.ajaxUrls["/luxletter/wizardUserPreview"],{usergroups:e.join(",")},"addWizardUserPreviewCallback")},c=function(){o();var e=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]'),e=(null!==e&&e.addEventListener("change",function(){o()}),document.querySelector('[data-luxletter-wizardpreviewevent="layout"]'));null!==e&&e.addEventListener("change",function(){o()})},o=function(){var e=document.querySelector('[data-luxletter-wizardpreview="newsletter"]'),t=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]'),r=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]');null!==e&&""!==t.value&&m(TYPO3.settings.ajaxUrls["/luxletter/previewSources"],{origin:t.value,layout:r.value},"newsletterPreviewCallback")},s=(this.newsletterPreviewCallback=function(e){var t=document.querySelector('[data-luxletter-wizardpreview="newsletter"]');t.innerHTML="";for(var r=0;r<e.length;r++){var l,n=document.createElement("div"),a=(n.setAttribute("class","luxletter-iframepreview-children"),document.createElement("iframe"));a.setAttribute("src",e[r].url),e[r].subject&&((l=document.createElement("h2")).innerHTML=e[r].subject,n.appendChild(l)),n.appendChild(a),t.appendChild(n),i=!0}},function(){var e=document.querySelector('[data-luxletter-testmail="submit"]');null!==e&&e.addEventListener("click",function(e){e.preventDefault();var e=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]').value,t=document.querySelector('[data-luxletter-testmail="email"]').value,r=document.querySelector('[data-luxletter-testmail="subject"]'),l=document.querySelector('[data-luxletter-testmail="configuration"]').value,n=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]').value;e&&t&&n&&m(TYPO3.settings.ajaxUrls["/luxletter/testMail"],{origin:e,email:t,subject:null!==r?r.value:"",configuration:l,layout:n},"testMailListenerCallback")})}),d=function(){for(var e=document.querySelectorAll("[data-luxletter-linkmockaction]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.getAttribute("data-luxletter-linkmockaction");document.querySelector('[data-luxletter-linkmock-link="'+e+'"]').click()})},v=function(){for(var e=document.querySelectorAll("[data-luxletter-action-ajax]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("data-luxletter-action-ajax");m(TYPO3.settings.ajaxUrls["/luxletter/receiverdetail"],{user:e},"userDetailListenerCallback")})},f=function(){for(var e=document.querySelectorAll("[data-luxletter-confirm]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.currentTarget.getAttribute("data-luxletter-confirm");!1===confirm(t)&&e.preventDefault()})},m=(this.addWizardUserPreviewCallback=function(e){var t=document.querySelector('[data-luxletter-wizardpreview="users"]');null!==t&&(t.innerHTML=e.html,r=!0,w())},this.testMailListenerCallback=function(e){var t,r,l=document.querySelector('[data-luxletter-testmail="message"]');null!==l&&void 0===e.statusSeverity&&!0===e.status?(h(l),t=l.querySelector("p>span"),r=parseInt(t.innerHTML),t.innerHTML=(++r).toString()):null!==l&&""!==e.statusSeverity&&!0===e.status&&(l.classList.remove(...l.classList),l.classList.add("alert"),l.classList.add(e.statusSeverity),l.querySelector(".alert-heading").innerHTML=e.statusTitle,l.querySelector("p").innerHTML=e.statusMessage,h(l))},this.userDetailListenerCallback=function(e){var t=document.getElementById("luxletter-newsletter-receiver-container");null!==t&&(t.innerHTML=e.html)},function(e,t,r){var l;void 0!==e&&""!==e?((l=new XMLHttpRequest).onreadystatechange=function(){4===this.readyState&&200===this.status&&null!==r&&n[r](JSON.parse(this.responseText))},l.open("POST",x(e,t),!0),l.send()):console.log("No ajax URI given!")}),w=function(){if(y()&&g())for(var e=document.querySelectorAll("[data-luxletter-wizardstatus]"),t=0;t<e.length;t++)"ready"===e[t].getAttribute("data-luxletter-wizardstatus")?h(e[t]):"pending"===e[t].getAttribute("data-luxletter-wizardstatus")&&p(e[t])},y=function(){return i&&r},g=function(){for(var e=document.querySelectorAll("[data-luxletter-mandatory]"),t=0;t<e.length;t++)if(0===e[t].value||""===e[t].value)return!1;return!0},x=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(-1!==e.indexOf("?")?e+="&":e+="?",e+=r+"="+encodeURIComponent(t[r]));return e},p=function(e){e.style.display="none"},h=function(e){e.style.display="block"}}e(document).ready(function(){(new t).initialize()})});