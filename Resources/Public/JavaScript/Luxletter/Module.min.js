define(["jquery","TYPO3/CMS/Luxletter/Vendor/Multiselect"],function(e){"use strict";e(document).ready(function(){new function(e){var t=this,r=!1,l=!1;this.initialize=function(){a(),u(),c(),d(),s(),v(),m(),f()};var a=function(){for(var e=document.querySelectorAll(".wizardform > fieldset"),t=document.querySelectorAll("[data-wizardform-gotostep]"),r=document.querySelectorAll(".wizard > a"),l=1;l<e.length;l++)g(e[l]);for(var a=0;a<t.length;a++)t[a].addEventListener("click",function(t){t.preventDefault();var l=this.getAttribute("data-wizardform-gotostep");n(r,"current"),r[l-1].classList.add("current");for(var a=0;a<e.length;a++)g(e[a]);S(e[l-1]),x()})},n=function(e,t){for(var r=0;r<e.length;r++)e[r].classList.remove(t)},u=function(){i();for(var e=document.querySelectorAll('input[data-luxletter-wizardpreviewevent="users"][type="checkbox"]'),t=0;t<e.length;t++)e[t].addEventListener("change",function(e){i()})},i=function(){for(var e=document.querySelectorAll('input[data-luxletter-wizardpreviewevent="users"][type="checkbox"]:checked,input[data-luxletter-wizardpreviewevent="users"][type="hidden"]'),t=[],r=0;r<e.length;r++)t.push(e[r].getAttribute("value"));w(TYPO3.settings.ajaxUrls["/luxletter/wizardUserPreview"],{usergroups:t.join(",")},"addWizardUserPreviewCallback")},c=function(){o();var e=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]');null!==e&&e.addEventListener("change",function(){o()});var t=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]');null!==t&&t.addEventListener("change",function(){o()})},o=function(){var e=document.querySelector('[data-luxletter-wizardpreview="newsletter"]'),t=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]'),r=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]');null!==e&&""!==t.value&&w(TYPO3.settings.ajaxUrls["/luxletter/previewSources"],{origin:t.value,layout:r.value},"newsletterPreviewCallback")};this.newsletterPreviewCallback=function(e){var t=document.querySelector('[data-luxletter-wizardpreview="newsletter"]');t.innerHTML="";for(var l=0;l<e.length;l++){var a=document.createElement("div");a.setAttribute("class","luxletter-iframepreview-children");var n=document.createElement("iframe");if(n.setAttribute("src",e[l].url),e[l].subject){var u=document.createElement("h2");u.innerHTML=e[l].subject,a.appendChild(u)}a.appendChild(n),t.appendChild(a),r=!0}};var d=function(){var e=document.querySelector('[data-luxletter-testmail="submit"]');null!==e&&e.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]').value,r=document.querySelector('[data-luxletter-testmail="email"]').value,l=document.querySelector('[data-luxletter-testmail="subject"]'),a=document.querySelector('[data-luxletter-testmail="configuration"]').value,n=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]').value;t&&r&&n&&w(TYPO3.settings.ajaxUrls["/luxletter/testMail"],{origin:t,email:r,subject:null!==l?l.value:"",configuration:a,layout:n},"testMailListenerCallback")})},s=function(){for(var e=document.querySelectorAll("[data-luxletter-linkmockaction]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.getAttribute("data-luxletter-linkmockaction");document.querySelector('[data-luxletter-linkmock-link="'+e+'"]').click()})},v=function(){for(var e=document.querySelectorAll("[data-luxletter-action-ajax]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-luxletter-action-ajax");w(TYPO3.settings.ajaxUrls["/luxletter/receiverdetail"],{user:t},"userDetailListenerCallback")})},f=function(){var e=document.querySelector("#vsb-multiselect");new vanillaSelectBox("#vsb-multiselect",{maxHeight:200,maxWidth:-1,search:!0,placeHolder:e.getAttribute("data-placeholder")}).enable()},m=function(){for(var e=document.querySelectorAll("[data-luxletter-confirm]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.currentTarget.getAttribute("data-luxletter-confirm");!1===confirm(t)&&e.preventDefault()})};this.addWizardUserPreviewCallback=function(e){var t=document.querySelector('[data-luxletter-wizardpreview="users"]');null!==t&&(t.innerHTML=e.html,l=!0,x())},this.testMailListenerCallback=function(e){var t=document.querySelector('[data-luxletter-testmail="message"]');null!==t&&S(t)},this.userDetailListenerCallback=function(e){var t=document.getElementById("luxletter-newsletter-receiver-container");null!==t&&(t.innerHTML=e.html)};var w=function(e,r,l){if(void 0!==e&&""!==e){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===this.readyState&&200===this.status&&null!==l&&t[l](JSON.parse(this.responseText))},a.open("POST",p(e,r),!0),a.send()}else console.log("No ajax URI given!")},x=function(){if(y()&&h())for(var e=document.querySelectorAll("[data-luxletter-wizardstatus]"),t=0;t<e.length;t++)"ready"===e[t].getAttribute("data-luxletter-wizardstatus")?S(e[t]):"pending"===e[t].getAttribute("data-luxletter-wizardstatus")&&g(e[t])},y=function(){return r&&l},h=function(){for(var e=document.querySelectorAll("[data-luxletter-mandatory]"),t=0;t<e.length;t++)if(0===e[t].value||""===e[t].value)return!1;return!0},p=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(-1!==e.indexOf("?")?e+="&":e+="?",e+=r+"="+encodeURIComponent(t[r]));return e},g=function(e){e.style.display="none"},S=function(e){e.style.display="block"}}(e).initialize()})});
